[gd_scene load_steps=13 format=3 uid="uid://b8lfeevqv0ver"]

[ext_resource type="Script" path="res://scenes/Levels/tutorial_levels/tutorial_2/tutorial_2.gd" id="1"]
[ext_resource type="PackedScene" uid="uid://cydr4afr1m1ol" path="res://scenes/Player/Player.tscn" id="2"]
[ext_resource type="PackedScene" uid="uid://du05w5f78xwh3" path="res://scenes/PlayerUI/Pause/PauseScreen.tscn" id="3"]
[ext_resource type="PackedScene" path="res://scenes/LevelObjects/SimpleLight/SimpleLight.tscn" id="4"]
[ext_resource type="PackedScene" uid="uid://b1yeu7c1c0dsb" path="res://scenes/Interface/Dialog/overlay_dialog.tscn" id="5_tyn7f"]
[ext_resource type="PackedScene" uid="uid://ceaeqlvprxd2l" path="res://scenes/LevelObjects/Lander/Lander.tscn" id="6"]
[ext_resource type="TileSet" uid="uid://i8xyuixoae02" path="res://gfx/tiles/godot_4_tileset.tres" id="6_ddj5s"]
[ext_resource type="PackedScene" uid="uid://cyiyvv24e8gsh" path="res://scenes/PlayerUI/MissionComplete/MissionComplete.tscn" id="7"]
[ext_resource type="PackedScene" uid="uid://dqbfngx8h1y4l" path="res://scenes/PlayerUI/MissionObjectives/MissionObjectives.tscn" id="8"]

[sub_resource type="Shader" id="1"]
code = "shader_type canvas_item;

uniform vec4 color : source_color = vec4(0.35, 0.48, 0.95, 1.0);
uniform float noise_scale = 20.0;
uniform float alpha_power = 2.0;
uniform int OCTAVES = 1;
uniform float TIME_FACTOR = 1.0;

float rand(vec2 coord){
	return fract(sin(dot(coord, vec2(56, 78)) * 1000.0) * 1000.0);
}

float noise(vec2 coord){
	vec2 i = floor(coord);
	vec2 f = fract(coord);

	// 4 corners of a rectangle surrounding our point
	float a = rand(i);
	float b = rand(i + vec2(1.0, 0.0));
	float c = rand(i + vec2(0.0, 1.0));
	float d = rand(i + vec2(1.0, 1.0));

	vec2 cubic = f * f * (3.0 - 2.0 * f);

	return mix(a, b, cubic.x) + (c - a) * cubic.y * (1.0 - cubic.x) + (d - b) * cubic.x * cubic.y;
}

float fbm(vec2 coord){
	float value = 0.0;
	float scale = 0.5;

	for(int i = 0; i < OCTAVES; i++){
		value += noise(coord) * scale;
		coord *= 2.0;
		scale *= 0.5;
	}
	return value;
}

void fragment() {
	vec2 coord = UV * noise_scale;
	float abs_time = TIME * TIME_FACTOR;
	vec2 motion = vec2( fbm(coord + vec2(abs_time * -0.5, abs_time * 0.5)) );
	float final = fbm(coord + motion);
	COLOR = vec4(color.rgb, pow(final, alpha_power) * color.a);
}"

[sub_resource type="ShaderMaterial" id="2"]
shader = SubResource("1")
shader_parameter/color = Color(0.172549, 0.184314, 0.235294, 1)
shader_parameter/noise_scale = 3.0
shader_parameter/alpha_power = 2.0
shader_parameter/OCTAVES = 3
shader_parameter/TIME_FACTOR = 0.3

[sub_resource type="NoiseTexture2D" id="3"]
seamless = true

[node name="Tutorial2" type="Node2D"]
script = ExtResource("1")

[node name="Background" type="Polygon2D" parent="."]
material = SubResource("2")
texture = SubResource("3")
polygon = PackedVector2Array(128, 576, 256, 576, 384, 448, 640, 448, 768, 576, 1152, 576, 1280, 448, 1536, 448, 1664, 576, 1792, 576, 1792, -192, 1664, -320, 256, -320, 128, -192)

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Objectives" parent="CanvasLayer" instance=ExtResource("8")]

[node name="MissionComplete" parent="CanvasLayer" instance=ExtResource("7")]
visible = false

[node name="PauseScreen" parent="CanvasLayer" instance=ExtResource("3")]

[node name="OverlayDialog" parent="CanvasLayer" instance=ExtResource("5_tyn7f")]

[node name="MapTiles" type="TileMap" parent="."]
tile_set = ExtResource("6_ddj5s")
format = 2
layer_0/tile_data = PackedInt32Array(1, 131072, 1, 131073, 131072, 1, 262145, 131072, 1, 393217, 131072, 1, 524289, 131072, 1, 589825, 262144, 0, 458753, 131072, 1, 327681, 131072, 1, 196609, 131072, 0, 65537, 131072, 0, -65535, 131072, 1, -131071, 131072, 1, -196607, 131072, 1, -262143, 327680, 0, -393213, 327680, 0, -262142, 131072, 5, -327677, 196608, 4, -327678, 131072, 4, -393212, 0, 1, -393211, 0, 1, -393210, 0, 1, -393209, 0, 1, -393208, 0, 1, -393207, 0, 1, -393206, 0, 1, -393205, 0, 1, -393204, 0, 1, -393203, 0, 1, -393202, 0, 1, -393201, 0, 1, -393200, 0, 1, -393199, 0, 1, -393198, 0, 1, -393197, 0, 1, -393196, 0, 1, -393195, 0, 1, -393194, 0, 1, -393193, 0, 1, -393192, 0, 1, -393191, 0, 1, -393190, 262144, 1, -262116, 262144, 1, -327654, 262144, 4, -262117, 327680, 5, -327653, 327680, 4, -196580, 196608, 0, -131044, 196608, 0, -65508, 196608, 0, 28, 196608, 0, 65564, 196608, 0, 131100, 196608, 0, 196636, 196608, 0, 262172, 196608, 0, 327708, 196608, 0, 393244, 196608, 0, 458780, 196608, 0, 524316, 196608, 0, 589852, 327680, 1, 589851, 0, 0, 589850, 0, 0, 589849, 262144, 0, 524313, 65536, 5, 458776, 65536, 5, 524312, 0, 5, 458775, 0, 0, 458774, 0, 0, 458773, 0, 0, 458772, 0, 0, 458761, 65536, 0, 458760, 65536, 0, 458759, 65536, 0, 458758, 65536, 0, 458762, 0, 4, 524298, 0, 5, 524299, 65536, 5, 589835, 262144, 0, 589836, 0, 0, 589837, 0, 0, 589838, 0, 0, 589839, 0, 0, 458771, 393216, 5, 524307, 458752, 5, 524306, 393216, 5, 589842, 327680, 1, 589840, 0, 0, 589841, 0, 0, 458757, 458752, 4, 524293, 458752, 5, 524292, 393216, 5, 589828, 327680, 1, 589826, 0, 0, 589827, 0, 0)

[node name="Lights" type="Node2D" parent="."]

[node name="SimpleLight" parent="Lights" instance=ExtResource("4")]
position = Vector2(512, -320)
rotation = 3.14159
strength = 1.5
direction = 1

[node name="SimpleLight2" parent="Lights" instance=ExtResource("4")]
position = Vector2(1408, -320)
rotation = 3.14159
strength = 1.5
direction = 1

[node name="SimpleLight3" parent="Lights" instance=ExtResource("4")]
position = Vector2(944, 576)
strength = 1.5

[node name="Player" parent="." instance=ExtResource("2")]
position = Vector2(512, 424)

[node name="Camera2D" type="Camera2D" parent="Player"]

[node name="Landers" type="Node2D" parent="."]

[node name="Lander" parent="Landers" instance=ExtResource("6")]
position = Vector2(1360, 448)

[node name="CanvasModulate" type="CanvasModulate" parent="."]
visible = false
color = Color(0.262745, 0.278431, 0.435294, 1)

[connection signal="mission_complete" from="CanvasLayer/Objectives" to="." method="_on_objectives_mission_complete"]
